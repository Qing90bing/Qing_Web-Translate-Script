# `build-tasks/lib`

## 目录概述

`build-tasks/lib` 目录是构建任务系统的核心库，它提供了一系列基础模块和辅助函数，用于支持 `/build-tasks/tasks` 目录中各种具体构建任务的实现。此目录下的模块负责处理底层的、可重用的逻辑，如文件操作、用户交互、错误校验和文本修复等，从而使上层的任务脚本能够更专注于其特定的业务逻辑。

这种分层设计（库/任务）提高了代码的可维护性、可重用性和清晰度。

---

## 文件结构和功能

本目录包含以下关键文件：

-   **`colors.js`**
    -   **功能**: 提供一套用于在终端中为文本添加 ANSI 颜色的工具函数。
    -   **职责**: 封装了标准的 ANSI 转义码，使得其他模块可以方便地以可读性高的方式（如 `color.green('Success')`）输出带颜色的文本，增强了命令行输出的可读性。

-   **`fixing.js`**
    -   **功能**: 包含了所有用于实际修改文件内容的函数。
    -   **职责**: 此模块是所有“自动修复”和“手动修复”功能的执行者。它接收来自 `prompting.js` 的用户决策，并将其转化为具体的文件更改操作，例如删除行、替换文本、插入字符等。它采用从文件末尾向前修改的策略，以确保在修改过程中文件索引的稳定性。

-   **`prompting.js`**
    -   **功能**: 包含了所有与用户通过命令行进行交互的功能。
    -   **职责**: 基于 `inquirer` 库，提供了一系列函数来向用户提问、显示选项、请求输入。它是实现交互式修复流程的核心，负责收集用户的意图，并将其传递给 `fixing.js` 模块来执行。

-   **`terminal-i18n.js`**
    -   **功能**: 终端国际化（i18n）模块。
    -   **职责**: 负责管理和提供在命令行界面中显示的所有文本的翻译。它从 `locales/terminal` 目录加载语言配置和语言包，并提供一个核心的 `t()` 函数，使得整个命令行工具的界面语言可以轻松切换。

-   **`utils.js`**
    -   **功能**: 提供一系列通用的、与具体业务无关的辅助函数。
    -   **职责**: 目前主要包含 `pressAnyKeyToContinue()` 函数，用于在操作完成后暂停程序，等待用户确认，改善用户体验。

-   **`validation.js`**
    -   **功能**: 项目的核心校验引擎。
    -   **职责**: 负责查找所有翻译文件，使用 `acorn` 库将文件内容解析成抽象语法树（AST），然后遍历 AST 以发现各种类型的问题（如重复条目、空翻译、语法错误等）。它为所有检查任务提供了基础的数据发现和错误定位能力。

---

## 模块协同工作流程

这些模块通常以下列方式协同工作，以完成一个完整的“检查与修复”流程：

1.  **启动**: 一个位于 `/build-tasks/tasks` 中的任务脚本（例如 `check-duplicates.js`）被执行。
2.  **校验**: 该任务脚本调用 `validation.js` 中的 `validateTranslationFiles()` 函数来查找并分析所有相关的翻译文件。
3.  **发现错误**: `validation.js` 返回一个包含所有已发现错误的数组。
4.  **用户交互**: 任务脚本接收到错误列表后，调用 `prompting.js` 中的函数（如 `promptUserAboutErrors()`）向用户展示错误，并询问下一步操作（例如，自动修复、手动修复或忽略）。
5.  **执行修复**: 如果用户选择修复，`prompting.js` 会返回用户的具体决策。任务脚本随后将这些决策传递给 `fixing.js` 中的相应函数（如 `fixDuplicatesAutomatically()` 或 `applyManualFixes()`）。
6.  **完成**: `fixing.js` 执行实际的文件修改操作，完成修复。
7.  **辅助功能**: 在整个流程中，`colors.js` 用于美化输出，`terminal-i18n.js` 用于提供多语言文本，而 `utils.js` 则可能在某些步骤后用于暂停程序，等待用户确认。