# `build-tasks/tasks/check`

## 目录概述

`build-tasks/tasks/check` 目录包含了一系列独立的、可执行的检查任务脚本。每个脚本都专注于发现和处理翻译文件中的某一特定类型的问题。这些任务是项目质量控制的关键部分，确保了翻译数据的一致性、完整性和语法正确性。

用户可以通过主构建脚本（`build.js`）的交互式菜单来单独或批量运行这些检查任务。

---

## 文件结构和功能

本目录包含以下检查任务脚本：

-   **`check-comma.js`**
    -   **目标问题**: 检查并修复翻译文件中数组条目之间**可能遗漏的逗号**。
    -   **工作模式**:
        -   **自动修复**: 采用迭代式修复策略，每次只修复一个“高置信度”的错误，然后重新扫描，以保证修复的准确性。
        -   **手动修复**: 逐个向用户展示“低置信度”的错误，并提供带有高亮建议的修复预览，让用户确认。
    -   **复杂度**: 这是所有检查任务中最复杂的一个，因为它结合了复杂的自动和手动修复逻辑。

-   **`check-duplicates.js`**
    -   **目标问题**: 检查并修复完全相同的翻译条目（即原文和译文都相同）。
    -   **工作模式**:
        -   **自动修复**: 保留每组重复条目中的第一个，并移除所有后续的重复项。
        -   **手动修复**: 向用户展示每一组重复，并让用户选择要保留哪一个版本。

-   **`check-empty.js`**
    -   **目标问题**: 检查并修复译文为空字符串的条目（例如 `["原文", ""]`）。
    -   **工作模式**: 此问题没有自动修复模式。唯一的修复方式是**手动修复**，即逐个提示用户为这些条目输入正确的译文。

-   **`check-identical.js`**
    -   **目标问题**: 检查并修复原文和译文完全相同的条目。这通常是翻译未完成或占位符的标志。
    -   **工作模式**:
        -   **自动修复**: 提供两种策略供用户选择——将所有问题条目**批量移除**，或将其译文**批量置空**。
        -   **手动修复**: 逐个向用户展示问题条目，并让用户选择是**修改**、**移除**还是**忽略**。

-   **`check-source-duplicates.js`**
    -   **目标问题**: 检查并修复“原文重复”的问题，即同一个原文对应了多个不同的译文。
    -   **工作模式**:
        -   **自动修复**: 保留每组重复原文的第一个版本，并移除所有后续版本。
        -   **立即手动修复**: 采用一种特殊的“修复并立即重新验证”的模式。用户每次做出选择后，修复会立即应用，然后程序会重新扫描所有文件，确保后续决策基于最新的文件状态。

---

## 通用执行逻辑

所有检查任务都遵循一个相似的核心逻辑：

1.  **语法预检**: 在执行主要检查逻辑之前，任务会首先对所有文件进行语法检查。如果发现语法错误，任务会中止并强制用户先修复语法问题，因为语法错误会破坏 AST（抽象语法树）的准确性，导致后续检查结果不可靠。
2.  **调用核心库**: 每个任务脚本都大量依赖于 `/build-tasks/lib` 目录下的核心库模块来完成其实际工作：
    -   `validation.js`: 用于发现和定位问题。
    -   `prompting.js`: 用于与用户进行交互，获取修复决策。
    -   `fixing.js`: 用于执行实际的文件修改操作。
3.  **提供多种修复模式**: 大多数任务都提供了自动修复、手动修复和忽略等多种选项，给予用户充分的灵活性。