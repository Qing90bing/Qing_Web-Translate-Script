# `build-tasks/tasks/translation`

## 目录概述

`build-tasks/tasks/translation` 目录包含了一系列用于管理和维护翻译配置文件的任务脚本。这些脚本为开发者提供了一套自动化的工具，用于处理与翻译文件相关的常见操作，如添加、移除和排序，从而简化了多语言支持的开发流程。

用户可以通过主构建脚本（`build.js`）的交互式菜单来访问这些功能。

---

## 文件结构和功能

本目录包含以下关键任务脚本：

-   **`add-translation.js`**
    -   **功能**: 引导用户以交互方式添加一个新的网站翻译配置文件。
    -   **核心特性**: 这是一个**事务性**操作，能够自动创建 `.js` 文件，并更新 `index.js` 和 `header.txt`。如果过程中出现任何错误，它会自动**回滚**所有更改，确保项目状态的完整性。

-   **`remove-translation.js`**
    -   **功能**: 引导用户以交互方式移除一个现有的网站翻译配置文件。
    -   **核心特性**: 这是一个破坏性操作，会删除对应的 `.js` 文件，并从 `index.js` 和 `header.txt` 中移除相关条目。它具有**条件性移除**逻辑，只有在删除最后一个语言版本的翻译时，才会移除油猴脚本的 `@match` 指令。
    -   **风险**: 此任务不具备自动回滚能力，操作中途失败可能需要手动修复。

-   **`sort-translations.js`**
    -   **功能**: 对指定翻译文件中的 `textRules` 和 `regexRules` 数组进行排序。
    -   **核心特性**: 采用基于 **AST (抽象语法树)** 的安全方法进行排序，只修改目标数组，不影响文件的其他部分（如注释、代码结构等）。排序逻辑旨在优化可读性和版本控制差异。用户可以选择对单个文件、所有文件或特定规则类型进行批量排序。

-   **`manage-translations.js`**
    -   **功能**: 提供一个交互式的子菜单，作为上述翻译管理任务的统一入口。
    -   **核心特性**: 此脚本扮演着**路由器**的角色，它本身不执行文件操作，而是根据用户的选择调用 `add-translation.js` 或 `remove-translation.js` 等具体的任务处理器。

---

## 子目录

-   **`templates/`**
    -   **功能**: 存放用于生成新翻译配置文件的模板。
    -   **说明**: `add-translation.js` 任务会根据用户选择的语言，从这个目录中加载对应的模板来创建新文件。这确保了所有新配置文件都具有统一和标准的结构。详见该目录下的 `readme.md`。